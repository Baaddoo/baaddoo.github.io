<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Global News - Breaking Headlines</title>
<meta name="description" content="The latest news and headlines from the world's most important media outlets in one place. Stay informed with our real-time news aggregator.">
<meta name="keywords" content="news, headlines, breaking news, world news, media, press, rss, news aggregator, technology, sports, business, science">
<meta name="author" content="Global News">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2960719343978390" crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3P34ST6ZVZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-3P34ST6ZVZ');
</script>
<script type="application/ld+json" id="schema-markup"></script>
<style>
  :root {
    --primary-color: #1a73e8;
    --text-color: #333;
    --background-color: #f0f2f5;
    --card-background: #fff;
    --border-color: #e0e0e0;
    --secondary-text-color: #555;
    --tertiary-text-color: #888;
    --box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; background-color: var(--background-color); margin: 0; padding: 0; }
  .container { max-width: 1200px; margin: auto; padding: 20px; }
  header { text-align: center; margin-bottom: 20px; padding: 20px 0; border-bottom: 1px solid var(--border-color); }
  header h1 { color: var(--primary-color); margin: 0; font-size: 2.5em; font-weight: 700; }
  .nav-bar { position: sticky; top: 0; z-index: 100; background-color: var(--card-background); padding: 10px 0; border-bottom: 1px solid var(--border-color); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
  .nav-content { display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; max-width: 1200px; margin: auto; padding: 0 20px; }
  .category-nav { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; flex-grow: 1; }
  .category-nav a { display: flex; align-items: center; padding: 8px 15px; background-color: var(--background-color); color: var(--text-color); text-decoration: none; border-radius: 20px; transition: background-color 0.2s, color 0.2s; font-size: 0.9em; font-weight: 500; }
  .category-nav a i { margin-right: 8px; }
  .category-nav a:hover, .category-nav a.active { background-color: var(--primary-color); color: var(--card-background); }
  .search-container { display: flex; gap: 5px; margin-top: 10px; width: 100%; }
  .search-container input { padding: 8px 15px; border: 1px solid var(--border-color); border-radius: 20px; flex-grow: 1; outline: none; transition: border-color 0.2s; }
  .search-container input:focus { border-color: var(--primary-color); }
  .search-container button { padding: 8px 15px; border: none; background-color: var(--primary-color); color: var(--card-background); border-radius: 20px; cursor: pointer; transition: background-color 0.2s; }
  .search-container button:hover { background-color: #155bb5; }
  .country-section { margin-top: 40px; }
  .country-section h2 { border-bottom: 2px solid var(--primary-color); padding-bottom: 5px; margin-bottom: 20px; }
  .news-grid { list-style: none; padding: 0; display: grid; gap: 20px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
  .news-item { background-color: var(--card-background); border-radius: 12px; overflow: hidden; box-shadow: var(--box-shadow); transition: transform 0.3s ease, box-shadow 0.3s ease; display: flex; flex-direction: column; cursor: pointer; }
  .news-item:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
  .news-image-container { width: 100%; height: 200px; overflow: hidden; }
  .news-image { width: 100%; height: 100%; object-fit: cover; }
  .news-content { padding: 15px; display: flex; flex-direction: column; justify-content: space-between; flex-grow: 1; }
  .news-content h3 { margin: 0 0 10px; font-size: 1.1em; line-height: 1.4; color: var(--text-color); }
  .news-content p { font-size: 0.9em; color: var(--secondary-text-color); line-height: 1.5; margin: 0 0 10px; }
  .news-content a { text-decoration: none; color: var(--primary-color); font-weight: bold; }
  .news-source { font-size: 0.75em; color: var(--tertiary-text-color); display: flex; justify-content: space-between; align-items: center; }
  .loader { text-align: center; padding: 50px; font-size: 1.2em; color: var(--secondary-text-color); }
  #debug-log { background-color: #fce8e8; border: 1px solid #d93025; color: #d93025; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; }
  .popup-container { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.7); padding-top: 60px; }
  .popup-content { background-color: var(--card-background); margin: 5% auto; padding: 20px; border-radius: 10px; width: 90%; max-width: 700px; position: relative; text-align: center; }
  .close-btn { color: var(--tertiary-text-color); float: right; font-size: 28px; font-weight: bold; cursor: pointer; position: absolute; top: 10px; right: 20px; }
  .close-btn:hover, .close-btn:focus { color: var(--primary-color); }
  .popup-content h2 { font-size: 1.5em; color: var(--primary-color); margin-top: 0; }
  .popup-content img { max-width: 100%; height: auto; border-radius: 8px; margin: 15px 0; }
  .popup-content p { text-align: left; font-size: 1em; line-height: 1.5; }
  .popup-content a { display: inline-block; background-color: var(--primary-color); color: var(--card-background); padding: 10px 20px; margin-top: 15px; border-radius: 5px; text-decoration: none; font-weight: bold; }
  .adsense-text { font-size: 0.8em; color: var(--tertiary-text-color); margin-top: 20px; text-align: center; }
  .hidden { display: none; }
  .footer { text-align: center; padding: 20px; margin-top: 40px; font-size: 0.9em; color: var(--secondary-text-color); border-top: 1px solid var(--border-color); }
  .footer a { color: var(--primary-color); text-decoration: none; margin: 0 10px; cursor: pointer; }
  .footer-modal-content { text-align: left; }
  .footer-modal-content h2 { text-align: center; }
  #cookie-banner { position: fixed; bottom: 0; left: 0; width: 100%; background-color: var(--card-background); padding: 15px; text-align: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 2000; }
  #cookie-banner p { margin: 0; display: inline-block; vertical-align: middle; font-size: 0.9em; }
  #cookie-buttons { display: inline-block; vertical-align: middle; margin-left: 20px; }
  #cookie-accept, #cookie-decline { background-color: var(--primary-color); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin: 0 5px; font-size: 0.9em; }
  #cookie-decline { background-color: var(--border-color); color: var(--secondary-text-color); }
  .ad-container { text-align: center; padding: 20px; border: 1px solid var(--border-color); border-radius: 8px; background-color: #f9f9f9; margin: 20px 0; }
  .ad-container p { font-weight: bold; color: var(--text-color); font-size: 0.9em; text-align: center; }
  /* Estilos específicos para Material Symbols */
  .material-symbols-outlined {
    font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    margin-right: 8px;
  }
  
  @media (max-width: 768px) {
    .container { padding: 10px; }
    header h1 { font-size: 2em; }
    .nav-content { flex-direction: column; }
    .search-container { margin-top: 10px; }
    .category-nav { justify-content: flex-start; overflow-x: auto; white-space: nowrap; padding-bottom: 10px; }
    .category-nav a { flex: 0 0 auto; }
    .news-item { flex-direction: column; }
    .popup-content { width: 95%; padding: 15px; }
    #cookie-banner p, #cookie-buttons { display: block; margin-top: 10px; }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Global News</h1>
  </header>
  <div class="nav-bar">
    <div class="nav-content">
      <nav class="category-nav">
        <a href="index.html" class="category-link" data-category="all"><i class="fa-solid fa-house"></i>All</a>
        <a href="?category=world" class="category-link" data-category="world"><i class="fa-solid fa-earth-americas"></i>World</a>
        <a href="?category=nation" class="category-link" data-category="nation"><i class="fa-solid fa-flag"></i>Nation</a>
        <a href="?category=business" class="category-link" data-category="business"><i class="fa-solid fa-briefcase"></i>Business</a>
        <a href="?category=technology" class="category-link" data-category="technology"><i class="fa-solid fa-microchip"></i>Technology</a>
        <a href="?category=entertainment" class="category-link" data-category="entertainment"><i class="fa-solid fa-film"></i>Entertainment</a>
        <a href="?category=sports" class="category-link" data-category="sports"><i class="fa-solid fa-baseball-bat-ball"></i>Sports</a>
        <a href="?category=science" class="category-link" data-category="science"><i class="fa-solid fa-flask"></i>Science</a>
        <a href="?category=health" class="category-link" data-category="health"><i class="fa-solid fa-heart-pulse"></i>Health</a>
        <a href="?category=environment" class="category-link" data-category="environment"><i class="fa-solid fa-tree"></i>Environment</a>
        <a href="?category=politics" class="category-link" data-category="politics"><i class="fa-solid fa-gavel"></i>Politics</a>
        <a href="?category=travel" class="category-link" data-category="travel"><i class="fa-solid fa-plane"></i>Travel</a>
        <a href="?category=food" class="category-link" data-category="food"><i class="fa-solid fa-utensils"></i>Food</a>
        <a href="?category=automotive" class="category-link" data-category="automotive"><i class="fa-solid fa-car"></i>Automotive</a>
        <a href="?category=art" class="category-link" data-category="art"><i class="fa-solid fa-palette"></i>Art</a>
        <a href="?category=books" class="category-link" data-category="books"><i class="fa-solid fa-book"></i>Books</a>
        <a href="?category=movies" class="category-link" data-category="movies"><i class="fa-solid fa-clapperboard"></i>Movies</a>
        <a href="?category=music" class="category-link" data-category="music"><i class="fa-solid fa-music"></i>Music</a>
        <a href="?category=gaming" class="category-link" data-category="gaming"><i class="fa-solid fa-gamepad"></i>Gaming</a>
        <a href="?category=education" class="category-link" data-category="education"><i class="fa-solid fa-graduation-cap"></i>Education</a>
        <a href="?category=lifestyle" class="category-link" data-category="lifestyle"><i class="fa-solid fa-mug-hot"></i>Lifestyle</a>
      </nav>
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search news...">
        <button id="searchButton"><i class="fa-solid fa-magnifying-glass"></i></button>
      </div>
    </div>
  </div>
  <div id="debug-log">
    <h2>Load Errors:</h2>
    <ul id="error-list"></ul>
  </div>
  <div id="loader" class="loader">Loading news...</div>
  <div id="news-container"></div>
</div>
<div id="popup-container" class="popup-container">
  <div class="popup-content">
    <span class="close-btn">&times;</span>
    <h2 id="popup-title"></h2>
    <img id="popup-image" src="" alt="News image" class="hidden">
    <p id="popup-description"></p>
    <a id="popup-link" href="#" target="_blank" rel="noopener noreferrer">Go to full article</a>
    <div id="adsense-container">
      <p class="adsense-text">Advertisement</p>
    </div>
  </div>
</div>
<div id="legal-modal-container" class="popup-container">
  <div class="popup-content footer-modal-content">
    <span class="close-btn">&times;</span>
    <h2 id="legal-modal-title"></h2>
    <div id="legal-modal-text"></div>
  </div>
</div>
<div id="cookie-banner" style="display: none;">
  <p>This website uses cookies to ensure you get the best experience. By clicking "Accept", you agree to our use of cookies as described in our <a href="#" id="cookie-policy-link-banner" style="text-decoration: underline; cursor: pointer;">Cookie Policy</a>.</p>
  <div id="cookie-buttons">
    <button id="cookie-accept">Accept</button>
    <button id="cookie-decline">Decline</button>
  </div>
</div>
<footer class="footer">
  <p><strong>Disclaimer:</strong> This is a news aggregator website. All content and headlines are sourced from publicly available RSS feeds of various media outlets. We do not own the rights to the articles. The original content belongs to their respective owners.</p>
  <p>
    <a href="#" class="legal-link" data-content="terms">Terms and Conditions</a> | <a href="#" class="legal-link" data-content="privacy">Privacy Policy</a> | <a href="#" class="legal-link" data-content="cookies">Cookie Policy</a>
  </p>
  <p>&copy; 2024 Your Website. All Rights Reserved.</p>
</footer>
<div id="terms-content" class="hidden">
  <h2>Terms and Conditions</h2>
  <p><strong>1. Introduction</strong></p>
  <p>Welcome to [Your Website Name]. These terms and conditions govern your use of our website. By accessing or using this site, you agree to be bound by these terms. If you do not agree with any part of these terms, you must not use our website.</p>
  <p><strong>2. Intellectual Property</strong></p>
  <p>All content displayed on this website, including articles, images, and headlines, are sourced from external RSS feeds. We do not claim ownership of this content. The intellectual property rights to the original content belong to the respective news media outlets. You may not copy, reproduce, or distribute the content without the express permission of the original owner.</p>
  <p><strong>3. Use of the Website</strong></p>
  <p>This website is a news aggregator for personal, non-commercial use. You agree not to use the website for any unlawful purpose or in any way that could harm, disable, or overburden the site.</p>
  <p><strong>4. Disclaimer of Warranties</strong></p>
  <p>This website is provided on an "as is" and "as available" basis. We do not make any warranties, express or implied, regarding the accuracy, reliability, or completeness of the content. We are not responsible for any errors or omissions, or for any loss or damage of any kind incurred as a result of using the website.</p>
  <p><strong>5. Changes to Terms</strong></p>
  <p>We reserve the right to modify these terms and conditions at any time. Your continued use of the website after any such changes constitutes your acceptance of the new terms.</p>
</div>
<div id="privacy-content" class="hidden">
  <h2>Privacy Policy</h2>
  <p><strong>1. Information We Collect</strong></p>
  <p>We collect minimal data to operate this news aggregator. We may collect non-personally identifiable information such as IP addresses, browser types, and usage data to improve our services and analyze trends. We do not collect personal information like names, email addresses, or phone numbers unless you voluntarily provide them (e.g., via a contact form).</p>
  <p><strong>2. How We Use Information</strong></p>
  <p>The information we collect is used to:</p>
  <ul>
    <li>Analyze website traffic and usage patterns.</li>
    <li>Improve the functionality and content of the site.</li>
    <li>Ensure the security of our website.</li>
  </ul>
  <p><strong>3. Data Sharing</strong></p>
  <p>We do not sell, trade, or otherwise transfer your personally identifiable information to outside parties. We may share non-personally identifiable visitor information with partners for analytics or advertising purposes.</p>
  <p><strong>4. Third-Party Links</strong></p>
  <p>This website contains links to third-party websites (e.g., the original news sources). We have no control over the privacy practices of these sites and are not responsible for their content or policies. We encourage you to review the privacy policies of any third-party sites you visit.</p>
  <p><strong>5. Security</strong></p>
  <p>We take reasonable measures to protect the information we collect from unauthorized access, disclosure, or destruction. However, no internet transmission is completely secure, and we cannot guarantee absolute security.</p>
</div>
<div id="cookies-content" class="hidden">
  <h2>Cookie Policy</h2>
  <p>This website uses cookies to enhance your experience. A cookie is a small file placed on your device to remember information about your visit. We use cookies for the following purposes:</p>
  <ul>
    <li><strong>Essential Cookies:</strong> These cookies are necessary for the website to function correctly.</li>
    <li><strong>Analytics Cookies:</strong> We use Google Analytics to collect data on how visitors use our site. This helps us understand which content is popular and how we can improve.</li>
    <li><strong>Advertising Cookies:</strong> If you accept, we may use cookies to serve personalized ads through third-party ad networks (like Google AdSense).</li>
  </ul>
  <p>By using this website, you consent to our use of cookies in accordance with this policy. You can manage your cookie preferences through your browser settings.</p>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const newsContainer = document.getElementById('news-container');
    const loader = document.getElementById('loader');
    const debugLog = document.getElementById('debug-log');
    const errorList = document.getElementById('error-list');
    const schemaMarkup = document.getElementById('schema-markup');
    const categoryLinks = document.querySelectorAll('.category-link');
    const popupContainer = document.getElementById('popup-container');
    const newsCloseBtn = popupContainer.querySelector('.close-btn');
    const popupTitle = document.getElementById('popup-title');
    const popupImage = document.getElementById('popup-image');
    const popupDescription = document.getElementById('popup-description');
    const popupLink = document.getElementById('popup-link');
    const legalModalContainer = document.getElementById('legal-modal-container');
    const legalCloseBtn = legalModalContainer.querySelector('.close-btn');
    const legalModalTitle = document.getElementById('legal-modal-title');
    const legalModalText = document.getElementById('legal-modal-text');
    const legalLinks = document.querySelectorAll('.legal-link');
    const cookiePolicyLinkBanner = document.getElementById('cookie-policy-link-banner');
    const cookieBanner = document.getElementById('cookie-banner');
    const cookieAcceptBtn = document.getElementById('cookie-accept');
    const cookieDeclineBtn = document.getElementById('cookie-decline');
    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const hasAcceptedCookies = localStorage.getItem('cookiesAccepted') === 'true';
    const hasDeclinedCookies = localStorage.getItem('cookiesAccepted') === 'false';
    
    const googleFeeds = {
      'Argentina': { 'lang': 'es-419', 'gl': 'AR', 'ceid': 'AR:es-419' },
      'Australia': { 'lang': 'en-AU', 'gl': 'AU', 'ceid': 'AU:en' },
      'Austria': { 'lang': 'de-AT', 'gl': 'AT', 'ceid': 'AT:de' },
      'Bangladesh': { 'lang': 'bn-BD', 'gl': 'BD', 'ceid': 'BD:bn' },
      'Belgium (Dutch)': { 'lang': 'nl-BE', 'gl': 'BE', 'ceid': 'BE:nl' },
      'Belgium (French)': { 'lang': 'fr-BE', 'gl': 'BE', 'ceid': 'BE:fr' },
      'Bolivia': { 'lang': 'es-419', 'gl': 'BO', 'ceid': 'BO:es-419' },
      'Brazil': { 'lang': 'pt-BR', 'gl': 'BR', 'ceid': 'BR:pt-BR' },
      'Canada': { 'lang': 'en-CA', 'gl': 'CA', 'ceid': 'CA:en' },
      'Canada (French)': { 'lang': 'fr-CA', 'gl': 'CA', 'ceid': 'CA:fr' },
      'Chile': { 'lang': 'es-419', 'gl': 'CL', 'ceid': 'CL:es-419' },
      'China': { 'lang': 'zh-CN', 'gl': 'CN', 'ceid': 'CN:zh' },
      'Colombia': { 'lang': 'es-419', 'gl': 'CO', 'ceid': 'CO:es-419' },
      'Costa Rica': { 'lang': 'es-419', 'gl': 'CR', 'ceid': 'CR:es-419' },
      'Cuba': { 'lang': 'es-419', 'gl': 'CU', 'ceid': 'CU:es-419' },
      'Czechia': { 'lang': 'cs-CZ', 'gl': 'CZ', 'ceid': 'CZ:cs' },
      'Denmark': { 'lang': 'da-DK', 'gl': 'DK', 'ceid': 'DK:da' },
      'Dominican Republic': { 'lang': 'es-419', 'gl': 'DO', 'ceid': 'DO:es-419' },
      'Ecuador': { 'lang': 'es-419', 'gl': 'EC', 'ceid': 'EC:es-419' },
      'Egypt': { 'lang': 'ar-EG', 'gl': 'EG', 'ceid': 'EG:ar' },
      'El Salvador': { 'lang': 'es-419', 'gl': 'SV', 'ceid': 'SV:es-419' },
      'France': { 'lang': 'fr-FR', 'gl': 'FR', 'ceid': 'FR:fr' },
      'Germany': { 'lang': 'de-DE', 'gl': 'DE', 'ceid': 'DE:de' },
      'Greece': { 'lang': 'el-GR', 'gl': 'GR', 'ceid': 'GR:el' },
      'Guatemala': { 'lang': 'es-419', 'gl': 'GT', 'ceid': 'GT:es-419' },
      'Honduras': { 'lang': 'es-419', 'gl': 'HN', 'ceid': 'HN:es-419' },
      'Hong Kong': { 'lang': 'zh-HK', 'gl': 'HK', 'ceid': 'HK:zh' },
      'Hungary': { 'lang': 'hu-HU', 'gl': 'HU', 'ceid': 'HU:hu' },
      'India (English)': { 'lang': 'en-IN', 'gl': 'IN', 'ceid': 'IN:en' },
      'India (Hindi)': { 'lang': 'hi-IN', 'gl': 'IN', 'ceid': 'IN:hi' },
      'Indonesia': { 'lang': 'id-ID', 'gl': 'ID', 'ceid': 'ID:id' },
      'Ireland': { 'lang': 'en-IE', 'gl': 'IE', 'ceid': 'IE:en' },
      'Israel (Hebrew)': { 'lang': 'he-IL', 'gl': 'IL', 'ceid': 'IL:he' },
      'Italy': { 'lang': 'it-IT', 'gl': 'IT', 'ceid': 'IT:it' },
      'Japan': { 'lang': 'ja-JP', 'gl': 'JP', 'ceid': 'JP:ja' },
      'Kenya': { 'lang': 'en-KE', 'gl': 'KE', 'ceid': 'KE:en' },
      'Latvia': { 'lang': 'lv-LV', 'gl': 'LV', 'ceid': 'LV:lv' },
      'Lithuania': { 'lang': 'lt-LT', 'gl': 'LT', 'ceid': 'LT:lt' },
      'Malaysia': { 'lang': 'en-MY', 'gl': 'MY', 'ceid': 'MY:en' },
      'Mexico': { 'lang': 'es-419', 'gl': 'MX', 'ceid': 'MX:es-419' },
      'Morocco': { 'lang': 'fr-MA', 'gl': 'MA', 'ceid': 'MA:fr' },
      'Netherlands': { 'lang': 'nl-NL', 'gl': 'NL', 'ceid': 'NL:nl' },
      'New Zealand': { 'lang': 'en-NZ', 'gl': 'NZ', 'ceid': 'NZ:en' },
      'Nicaragua': { 'lang': 'es-419', 'gl': 'NI', 'ceid': 'NI:es-419' },
      'Nigeria': { 'lang': 'en-NG', 'gl': 'NG', 'ceid': 'NG:en' },
      'Norway': { 'lang': 'no-NO', 'gl': 'NO', 'ceid': 'NO:no' },
      'Panama': { 'lang': 'es-419', 'gl': 'PA', 'ceid': 'PA:es-419' },
      'Paraguay': { 'lang': 'es-419', 'gl': 'PY', 'ceid': 'PY:es-419' },
      'Peru': { 'lang': 'es-419', 'gl': 'PE', 'ceid': 'PE:es-419' },
      'Philippines': { 'lang': 'en-PH', 'gl': 'PH', 'ceid': 'PH:en' },
      'Poland': { 'lang': 'pl-PL', 'gl': 'PL', 'ceid': 'PL:pl' },
      'Portugal': { 'lang': 'pt-PT', 'gl': 'PT', 'ceid': 'PT:pt-PT' },
      'Romania': { 'lang': 'ro-RO', 'gl': 'RO', 'ceid': 'RO:ro' },
      'Russia': { 'lang': 'ru-RU', 'gl': 'RU', 'ceid': 'RU:ru' },
      'Saudi Arabia': { 'lang': 'ar-SA', 'gl': 'SA', 'ceid': 'SA:ar' },
      'Singapore': { 'lang': 'en-SG', 'gl': 'SG', 'ceid': 'SG:en' },
      'South Africa': { 'lang': 'en-ZA', 'gl': 'ZA', 'ceid': 'ZA:en' },
      'South Korea': { 'lang': 'ko-KR', 'gl': 'KR', 'ceid': 'KR:ko' },
      'Spain': { 'lang': 'es-ES', 'gl': 'ES', 'ceid': 'ES:es' },
      'Sweden': { 'lang': 'sv-SE', 'gl': 'SE', 'ceid': 'SE:sv' },
      'Switzerland (French)': { 'lang': 'fr-CH', 'gl': 'CH', 'ceid': 'CH:fr' },
      'Switzerland (German)': { 'lang': 'de-CH', 'gl': 'CH', 'ceid': 'CH:de' },
      'Taiwan': { 'lang': 'zh-TW', 'gl': 'TW', 'ceid': 'TW:zh' },
      'Tanzania': { 'lang': 'en-TZ', 'gl': 'TZ', 'ceid': 'TZ:en' },
      'Thailand': { 'lang': 'th-TH', 'gl': 'TH', 'ceid': 'TH:th' },
      'Turkey': { 'lang': 'tr-TR', 'gl': 'TR', 'ceid': 'TR:tr' },
      'Uganda': { 'lang': 'en-UG', 'gl': 'UG', 'ceid': 'UG:en' },
      'Ukraine': { 'lang': 'uk-UA', 'gl': 'UA', 'ceid': 'UA:uk' },
      'United Kingdom': { 'lang': 'en-GB', 'gl': 'GB', 'ceid': 'GB:en' },
      'United States': { 'lang': 'en-US', 'gl': 'US', 'ceid': 'US:en' },
      'Uruguay': { 'lang': 'es-419', 'gl': 'UY', 'ceid': 'UY:es-419' },
      'Venezuela': { 'lang': 'es-419', 'gl': 'VE', 'ceid': 'VE:es-419' },
      'Vietnam': { 'lang': 'vi-VN', 'gl': 'VN', 'ceid': 'VN:vi' }
    };
    
    let currentCategory = 'all';

    const getFeedUrl = (countryKey, category) => {
      const countryData = googleFeeds[countryKey];
      if (!countryData) return null;
      
      const baseUrl = 'https://news.google.com/rss';
      const topicPath = category === 'all' ? '' : `/headlines/section/topic/${category.toUpperCase()}`;
      return `${baseUrl}${topicPath}?hl=${countryData.lang}&gl=${countryData.gl}&ceid=${countryData.ceid}`;
    };

    const cleanDescription = (text) => {
      const doc = new DOMParser().parseFromString(text, 'text/html');
      return doc.body.textContent || "";
    };

    const createSlug = (title) => {
      return title.toString().toLowerCase()
        .replace(/\s+/g, '-')
        .replace(/[^\w-]+/g, '')
        .replace(/--+/g, '-')
        .replace(/-+$/, '');
    };

    const updateSchema = (item) => {
      const imageUrl = (item.enclosure && item.enclosure.link) || (item.thumbnail && item.thumbnail.url) || null;
      const schemaData = {
        "@context": "https://schema.org",
        "@type": "NewsArticle",
        "mainEntityOfPage": { 
          "@type": "WebPage", 
          "@id": item.link 
        },
        "headline": item.title,
        "image": [ imageUrl ],
        "datePublished": item.pubDate,
        "dateModified": item.pubDate,
        "author": { 
          "@type": "Organization", 
          "name": item.author || item.feed.title || "Unknown" 
        },
        "publisher": { 
          "@type": "Organization", 
          "name": item.feed.title || "News Aggregator", 
          "logo": { 
            "@type": "ImageObject", 
            "url": "https://www.example.com/logo.png" 
          } 
        },
        "description": cleanDescription(item.description || item.content)
      };
      schemaMarkup.textContent = JSON.stringify(schemaData, null, 2);
    };

    const showNewsModal = (item) => {
      const title = item.title;
      const description = cleanDescription(item.description || item.content);
      const imageUrl = (item.enclosure && item.enclosure.link) || (item.thumbnail && item.thumbnail.url);
      const link = item.link;
      popupTitle.textContent = title;
      popupDescription.textContent = description;
      popupLink.href = link;
      if (imageUrl) {
        popupImage.src = imageUrl;
        popupImage.alt = title;
        popupImage.classList.remove('hidden');
      } else {
        popupImage.src = '';
        popupImage.alt = '';
        popupImage.classList.add('hidden');
      }
      popupContainer.style.display = 'block';
      const slug = createSlug(title);
      const newUrl = `${window.location.protocol}//${window.location.host}${window.location.pathname}?category=${currentCategory}&slug=${slug}`;
      history.pushState({ path: newUrl }, '', newUrl);
      updateSchema(item);
    };

    const closeModal = () => {
      popupContainer.style.display = 'none';
      legalModalContainer.style.display = 'none';
      history.pushState({}, '', `?category=${currentCategory}`);
      schemaMarkup.textContent = ''; // Clear schema on close
    };

    newsCloseBtn.onclick = closeModal;
    legalCloseBtn.onclick = closeModal;
    window.onclick = (event) => {
      if (event.target == popupContainer || event.target == legalModalContainer) {
        closeModal();
      }
    };

    const showLegalModal = (title, contentId) => {
      const contentDiv = document.getElementById(contentId);
      if (contentDiv) {
        legalModalTitle.textContent = title;
        legalModalText.innerHTML = contentDiv.innerHTML;
        legalModalContainer.style.display = 'block';
      }
    };

    legalLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const contentType = e.target.getAttribute('data-content');
        if (contentType === 'terms') { showLegalModal('Terms and Conditions', 'terms-content'); }
        else if (contentType === 'privacy') { showLegalModal('Privacy Policy', 'privacy-content'); }
        else if (contentType === 'cookies') { showLegalModal('Cookie Policy', 'cookies-content'); }
      });
    });

    cookiePolicyLinkBanner.addEventListener('click', (e) => {
      e.preventDefault();
      showLegalModal('Cookie Policy', 'cookies-content');
    });

    window.onpopstate = (event) => {
      const urlParams = new URLSearchParams(window.location.search);
      const slug = urlParams.get('slug');
      if (!slug) { closeModal(); }
    };
    
    const extractImageFromContent = (content) => {
        const parser = new DOMParser();
        const htmlDoc = parser.parseFromString(content, 'text/html');
        const img = htmlDoc.querySelector('img');
        return img ? img.src : null;
    };
    
    const renderNews = (items, parentElement) => {
        items.slice(0, 10).forEach(item => { // Limit to 10 news items per country
            const li = document.createElement('li');
            li.classList.add('news-item');
            
            let imageUrl = (item.enclosure && item.enclosure.link) || (item.thumbnail && item.thumbnail.url);
            if (!imageUrl) {
              imageUrl = extractImageFromContent(item.content || item.description);
            }
    
            const newsImageContainer = document.createElement('div');
            newsImageContainer.classList.add('news-image-container');
            const newsContentDiv = document.createElement('div');
            newsContentDiv.classList.add('news-content');
            const shortDescription = item.description ? cleanDescription(item.description).substring(0, 150) + '...' : '';
    
            newsContentDiv.innerHTML = `
                <a href="${item.link}" target="_blank" rel="noopener noreferrer">
                    <h3>${item.title}</h3>
                </a>
                <p>${shortDescription}</p>
                <div class="news-source">Source: ${item.feed.title} | Published: ${new Date(item.pubDate).toLocaleDateString()}</div>
            `;
    
            if (imageUrl) {
                const img = new Image();
                img.classList.add('news-image');
                img.src = imageUrl;
                img.alt = item.title;
                img.onload = () => {
                    newsImageContainer.appendChild(img);
                    li.appendChild(newsImageContainer);
                    li.appendChild(newsContentDiv);
                    parentElement.appendChild(li);
                };
                img.onerror = () => {
                    li.appendChild(newsContentDiv);
                    parentElement.appendChild(li);
                };
            } else {
                li.appendChild(newsContentDiv);
                parentElement.appendChild(li);
            }
  
            li.addEventListener('click', (e) => { 
                if (e.target.tagName.toLowerCase() !== 'a' && e.target.closest('a') === null) {
                    showNewsModal(item); 
                }
            });
        });
    };

    const fetchAndRenderAllNews = (category) => {
      newsContainer.innerHTML = '';
      errorList.innerHTML = '';
      debugLog.style.display = 'none';
      loader.style.display = 'block';

      const countryKeys = Object.keys(googleFeeds);
      const shuffledCountryKeys = countryKeys.sort(() => 0.5 - Math.random());
      
      let pendingFetches = shuffledCountryKeys.length;
      
      shuffledCountryKeys.forEach(countryKey => {
        const feedUrl = getFeedUrl(countryKey, category);
        if (!feedUrl) {
          pendingFetches--;
          if (pendingFetches === 0) loader.style.display = 'none';
          return;
        }
        
        fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}`)
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP Error: ${response.status} at ${feedUrl}`);
            }
            return response.json();
          })
          .then(data => {
            if (data && data.status === 'ok' && data.items && data.items.length > 0) {
              const countrySection = document.createElement('div');
              countrySection.classList.add('country-section');
              const sectionTitle = document.createElement('h2');
              sectionTitle.textContent = countryKey;
              const newsGrid = document.createElement('ul');
              newsGrid.classList.add('news-grid');
              
              const feedSource = data.feed.title || new URL(feedUrl).hostname;
              const newsItems = data.items.map(item => ({ ...item, feed: { title: feedSource } }));
              
              renderNews(newsItems, newsGrid);
              countrySection.appendChild(sectionTitle);
              countrySection.appendChild(newsGrid);
              
              newsContainer.appendChild(countrySection);
            }
          })
          .catch(error => {
            console.error(`Error loading news from ${countryKey}:`, error);
            debugLog.style.display = 'block';
            const errorLi = document.createElement('li');
            errorLi.textContent = `Error loading news from ${countryKey}: ${error.message}`;
            errorList.appendChild(errorLi);
          })
          .finally(() => {
            pendingFetches--;
            if (pendingFetches === 0) {
              loader.style.display = 'none';
            }
          });
      });
    };

    const searchGoogleNews = (query) => {
      newsContainer.innerHTML = '';
      loader.style.display = 'block';
      const searchUrlTemplate = 'https://news.google.com/rss/search?q=';
      const queryUrl = `${searchUrlTemplate}${encodeURIComponent(query)}&hl=en-US&gl=US&ceid=US:en`;

      fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(queryUrl)}`)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP Error: ${response.status} during search`);
          }
          return response.json();
        })
        .then(data => {
          if (data.status === 'ok' && data.items && data.items.length > 0) {
            const searchResults = data.items.map(item => ({ ...item, feed: { title: 'Google News Search' } }));
            const searchSection = document.createElement('div');
            searchSection.classList.add('country-section');
            const sectionTitle = document.createElement('h2');
            sectionTitle.textContent = `Search Results for "${query}"`;
            const newsGrid = document.createElement('ul');
            newsGrid.classList.add('news-grid');
            renderNews(searchResults, newsGrid);
            searchSection.appendChild(sectionTitle);
            searchSection.appendChild(newsGrid);
            newsContainer.appendChild(searchSection);
          } else {
            newsContainer.innerHTML = '<div class="loader">No se encontraron noticias para la búsqueda.</div>';
          }
          loader.style.display = 'none';
        })
        .catch(error => {
          console.error("Error fetching search results:", error);
          newsContainer.innerHTML = '<div class="loader">Ocurrió un error al buscar noticias.</div>';
          loader.style.display = 'none';
        });
    };

    if (!hasAcceptedCookies && !hasDeclinedCookies) {
      cookieBanner.style.display = 'block';
    }

    cookieAcceptBtn.onclick = () => { localStorage.setItem('cookiesAccepted', 'true'); cookieBanner.style.display = 'none'; };
    cookieDeclineBtn.onclick = () => { localStorage.setItem('cookiesAccepted', 'false'); cookieBanner.style.display = 'none'; };

    categoryLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const category = e.target.getAttribute('data-category');
        categoryLinks.forEach(l => l.classList.remove('active'));
        e.target.classList.add('active');
        currentCategory = category;
        history.pushState({ category: currentCategory }, '', `?category=${currentCategory}`);
        fetchAndRenderAllNews(currentCategory);
      });
    });

    searchButton.addEventListener('click', () => {
      const searchTerm = searchInput.value.trim();
      if (searchTerm) {
        searchGoogleNews(searchTerm);
      } else {
        fetchAndRenderAllNews(currentCategory);
      }
    });

    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        searchButton.click();
      }
    });

    const urlParams = new URLSearchParams(window.location.search);
    currentCategory = urlParams.get('category') || 'all';
    fetchAndRenderAllNews(currentCategory);

    const activeLink = document.querySelector(`.category-link[data-category="${currentCategory}"]`);
    if (activeLink) {
      activeLink.classList.add('active');
    }
  });
</script>
</body>
</html>
